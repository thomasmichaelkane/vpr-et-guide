<!DOCTYPE html><html><head>
      <title>GUIDE</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Admin\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.11\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<br>
<div align="center">
  <a href="https://github.com/thomasmichaelkane/escape_tracer">
    <img src="images/et-logo.jpg" alt="logo" width="100">
  </a>
  <h3 align="center">Escape Tracer</h3>
  <p align="center">
    A guide to mouse behaviour analysis using escape tracer
    <br>
    <a href="https://github.com/thomasmichaelkane/escape_tracer"><strong>GitHub Repository</strong></a>
    <br>
    <br>
  </p>
</div>
<details>
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#installation">Installation</a></li>
      </ul>
    </li>
    <li><a href="#data-structure">Data Structure</a></li>
    <li>
      <a href="#workflow">Workflow</a></li>
      <ul>
        <li><a href="#config-file">Config File</a></li>
        <li><a href="#video-segmentation">Video Segmentation</a></li>
        <li><a href="#signal-analysis">Signal Analysis</a></li>
        <li><a href="#tracking-with-deeplabcut">Tracking With DeepLabCut</a></li>
        <li><a href="#analysing-a-single-video">Analysing a Single Video</a></li>
        <li><a href="#analysing-multiple-videos">Analysing Mutliple Videos</a></li>
      </ul>
    
    <li><a href="#license">License</a></li>
    <li><a href="#contact">Contact</a></li>
  </ol>
</details>
<h2 id="about-the-project">About The Project </h2>
<p>This project was created to analyse animal tracking data obtained from DeepLabCut alongside a signal that represents a stimulus (sound or otherwise) presented to the animal. Analysing a light signal that corresponds to stimulus presentation allows for fast and automated extraction and analysis of tracking data surrounding stimulus events. Escapes (or any other behavior associated with the stimulus) can be isolated and plotted to show path, direction, and speeds with ease.</p>
<h2 id="getting-started">Getting Started </h2>
<p>This is a guide on how to use escape tracer scripts to analyse animal behavior videos. All the instructions are given as terminal commands, like the one below.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python script_name.py argument1 argument2 <span class="token punctuation">..</span>.
</code></pre><p>Scripts refer to .py files that can be ran with the keyword <em>python</em>. The <em>arguments</em> are paths to files or other data we can pass to the script.</p>
<p><em><strong>Tip: The easiest way to copy a path correctly is to copy the file or folder itself, and then hit ctrl-v (paste) in the terminal</strong></em></p>
<p>If you are using escape tracer on a computer where it is already installed, skip the next section.</p>
<p align="center">(<a href="#data-structure">skip setup</a>)</p>
<h3 id="prerequisites">Prerequisites </h3>
<p>You will need to have Python 3 installed, as well as access to DeepLabCut. You will need Git installed if you want to clone the project from the terminal.</p>
<h3 id="installation">Installation </h3>
<ol>
<li>Clone the project at the desired location.<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token function">git</span> clone https://github.com/thomasmichaelkane/escape_tracer.git
</code></pre></li>
<li>Create a virtual environment.<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python <span class="token parameter variable">-m</span> venv .venv
</code></pre></li>
<li>Activate the virtual environment (everytime you use these scripts).</li>
</ol>
<ul>
<li>Windows:<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>.venv/Scripts/Activate.ps1   
</code></pre></li>
<li>Mac/Linux:<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">source</span> .venv/bin/activate
</code></pre></li>
</ul>
<ol start="4">
<li>Install the dependencies.<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt
</code></pre></li>
</ol>
<p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h2 id="data-structure">Data Structure </h2>
<p>It is important to keep the data structure in a certain way so that the scripts look for the files they need and deposit their outputs in the correct places. Keep the structure like the example below. One folder for all project data, inside this one folder for each video named by video number, inside each a folder named <em>raw</em>, and inside this the raw behavior video.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">.</span>
└── project_data/
    ├── 0001/
    │   └── raw/
    │       └── 0001_FILE-INFO.avi
    ├── 0002
    ├── 0003
    ├── 0004
    └── <span class="token punctuation">..</span>.
</code></pre><p>This is important as folders like the one shown below, called <em>processed</em>, will be created in the correct location automatically when scripts are run.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">.</span>
└── project_data/
    ├── 0001/
    │   ├── raw/
    │   │   └── 0001_FILE-INFO.avi
    │   └── processed/
    │       └── <span class="token punctuation">..</span>.
    ├── 0002
    ├── 0003
    ├── 0004
    └── <span class="token punctuation">..</span>.
</code></pre><p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h2 id="workflow">Workflow </h2>
<p>The workflow from a raw video to analysis is a five step process. There are some notes below about setup and config, and then the four sections are explained in detail. The main process is:</p>
<ol>
  <li>Segmenting the raw video into two videos. One for tracking and one for the signal.</li>
  <li>Analysing the signal video to find when the stimulus is on or off.</li>
  <li>Using DeepLabCut to track bodyparts in the video for tracking.</li>
  <li>Running Escape Tracer to create beautiful plots and get stats of escapes.</li>
</ol>
<p align="right">(<a href="#about-the-project">back to top</a>)</p>
<p><a name="activate" href=""></a></p>
<h4 id="before-you-start">Before you start </h4>
<p>Make sure that you are at the correct terminal location (in the folder that contains the escape_tracer scripts).</p>
<p>Activate the virtual environment in order to run scripts.</p>
<ul>
<li>Windows:<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>.venv/Scripts/Activate.ps1   
</code></pre></li>
<li>Mac/Linux:<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">source</span> .venv/bin/activate
</code></pre></li>
</ul>
<p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h3 id="config-file">Config File </h3>
<p>The config.yaml file contains various settings that can be edited. Most of these can be left alone for the monica setup. Ones that might want to be edited I have shown below. The comments shown here, and within the file, should be self-explanatory. Most importantly, the <em>target_bodypart</em> must match what was used in DeepLabCut.</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">tracking</span><span class="token punctuation">:</span>
    <span class="token key atrule">target_bodypart</span><span class="token punctuation">:</span> head base <span class="token comment"># must match string in h5 tracking file</span>
    <span class="token key atrule">event</span><span class="token punctuation">:</span>  <span class="token comment"># timings (in seconds) for analysis of escapes</span>
        <span class="token key atrule">t_minus</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># before stim</span>
        <span class="token key atrule">length</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token comment"># stim length</span>
        <span class="token key atrule">t_plus</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># after stim</span>
    <span class="token key atrule">min_escape_frames</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># the minimum frames with a speed of zero during the escape window to count as an escape </span>
    <span class="token key atrule">max_escape_window</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token comment"># the escape window (in seconds) after stim onset</span>
</code></pre><p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h3 id="video-segmentation">Video Segmentation </h3>
<p>We start with a video in a folder like the one shown below.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">.</span>
└── 0001/
    └── raw/
        └── 0001_FILE-INFO.avi
</code></pre><p>The first step in this process is to segment the raw video into two new videos. One video (arena.avi) will be used for tracking with DeepLabCut, and the other (signal.avi) will be used for analysing the light signal that corresponds to the stimulus.</p>
<p>Run the <em>segment_video.py</em> script with one argument; the path to the video we want to segment.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python segment_video.py <span class="token string">"c:/.../0001_FILE-INFO.avi"</span>
</code></pre><p>Once the script has been run you should be presented with an image from the video.</p>
<div align="center">
  <img src="images/draw_blank.jpg" alt="" width="512">
</div>
<br>
<p>The window will ask you to select the signal by clicking on it. You can click as many times as you like (and see them update in the terminal window), and then confirm when you are happy by hitting ENTER. You will then be presented with the image again and asked to click on the exit via the same process. The image below shows an example of the points you want to click. Make sure to hit the exact centre of the exit (on the floor).</p>
<div align="center">
  <img src="images/draw_arrows.jpg" alt="" width="512">
</div>
<br>
<p>Finally you will be presented with the same image with the segmentation rectangles for the signal, and for the arena and exit (which are bother anchored on where you clicked for the exit). If you are happy with this segmentation, you can confirm by simply hitting ENTER. Hit ESC to exit without saving, and hit any other key if you want to try again. Make sure it looks like the one shown below.</p>
<div align="center">
  <img src="images/segmentation.jpg" alt="" width="512">
</div>
<br>
<p>The script will then begin segmenting the video into the two new ones. This will take some time, the progress will be shown in the terminal.</p>
<p>Once the script is complete, if successful, you should find a new folder called <em>processed</em>, with three new files in it. Two video files, one for the signal, and one for the tracking area, and an image showing where the signal area and tracking areas were obtained from, and also showing the exit location that will be used in analysis later.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>└── 0001/
    ├── raw
    └── processed/
        ├── 0001_FILE-INFO_arena.avi
        ├── 0001_FILE-INFO_signal.avi
        └── 0001_FILE-INFO_segmentation.tif
</code></pre><p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h3 id="signal-analysis">Signal Analysis </h3>
<p>The next step in this process is to analyse the signal video to extract the stimulus</p>
<p>Run the <em>analyse_signal.py</em> script with one argument; the path to the signal video we created.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python analyse_signal.py <span class="token string">"c:/.../0001_FILE-INFO_signal.avi"</span>
</code></pre><p>The script will look at the number of bright pixels in the signal video to determine whether the stimulus is on or off. It will then present a graph of it's estimates for you to check. The image below shows a successful output where the red line cuts between the light turning on and off.</p>
<div align="center">
  <img src="images/stim-analysis.jpg" alt="" width="512">
</div>
<br>
<p>If it does not work first time you can try again with new variables. Close the graph and you will be asked to confirm whether it ran successfully or not. Type <em>y</em> to accept or type <em>n</em> to repeat the process. You will then be asked in the terminal to type new varaibles.</p>
<p>The <em>threshold</em> (default=40) value is the number of bright pixels requied for ON (height of the red line). The <em>start_frame</em> (default=1000) and <em>end_frame</em> (default=0) variables are for setting the first or last <em>x</em> frames automatically to OFF due to interference (see the start of the graph above for an example). Hit ENTER without entering a new value to keep the default value. Once new variables are set the script will rerun and can be rerun until the signal is analysed correctly.</p>
<p>Once the script is complete, if successful, you should in the <em>processed</em> processed folder two new files. The first is a csv file  of 1s and 0s that shows when the stimulus is on, each row representing a frame. The second is an image showing how the stimulus file was created by analysing the signal video.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">.</span>
└── 0001/
    ├── raw
    └── processed/
        ├── 0001_FILE-INFO_arena.avi
        ├── 0001_FILE-INFO_signal.avi
        ├── 0001_FILE-INFO_segmentation.tif
        ├── 0001_FILE-INFO_stim-analysis.jpg
        └── 0001_FILE-INFO_stim.csv
</code></pre><p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h3 id="tracking-with-deeplabcut">Tracking With DeepLabCut </h3>
<p>To track the animal in the arena we will use DeepLabCut. Installation and training with DeepLabCut is beyond the scope of this guide, I will just explain how to use a pretrained DLC project for our purposes.</p>
<div align="center">
  <a href="https://deeplabcut.github.io/DeepLabCut/README.html">
    <img src="images/dlc-logo.png" alt="dlc" width="250">
  </a>
</div>
<br>
<p>Using DeepLabCut is separate to escape tracer, so we can open a fresh terminal</p>
<p>In the terminal start the DEEPLABCUT conda environment.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>conda activate DEEPLABCUT
</code></pre><p>Then run the DeepLabCut GUI</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python <span class="token parameter variable">-m</span> deeplabcut
</code></pre><p>The GUI should start and look like this below.</p>
<div align="center">
  <img src="images/dlc-gui.png" alt="dlc-gui" width="512">
</div>
<br>
<p>Load the DeepLabCut project (the pretrained model) by selecting the config.yaml file in the project folder. we will use for tracking. Now switch to the <em>Analyze videos</em> tab and add in all the videos you want to track. They can remain in their original project data video folders for this process, or if needed can be moved or copied out for this step. Click the analyse videos button and DeepLabCut will start. <strong>This will likely take a very long time</strong>. The terminal will give you updates on progress and any error messages.</p>
<p>Once this is complete, the tracking files have been created, but we still need to create labelled videos. Navigate to the <em>Create videos</em> tab and click the create videos button. This will also take some time to complete, and again the terminal will report updates and errors.</p>
<p>Once all labelled videos have been created; the arena.avi videos, the .h5 tracking files, and the new labelled videos should all be placed back in their corresponding video number processed folders.</p>
<p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h3 id="analysing-a-single-video">Analysing a Single Video </h3>
<p>Remember to use a terminal window with the <a href="#before-you-start">escape tracer environment activated</a>.</p>
<p>To run the escape tracer, you need to run the <em>run_escape_tracer.py</em> script. Add one argument that is the path to the tracking file obtained from DeepLabCut. It <strong>needs to be in the processed folder</strong> so that it can also find the stim.csv file that is used in analysis.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python run_escape_tracer.py <span class="token string">"c:/.../0001_FILE-INFO_tracking-file.h5"</span>
</code></pre><p>Once the script is complete, if successful, you should find a new folder called <em>analysis</em>, with an <em>et_output</em> folder inside it. If this is not the first time analysing this video, you will find a new time stamped <em>et_output</em> folder in the analysis folder that already exists.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">.</span>
└── 0001/
    ├── raw
    ├── processed
    └── analysis/
        └── et_output_2024-01-01_00-04-20
</code></pre><p>The <em>et_output</em> folder contains some global files, as well as a folder for every event related to a stimulus. There are three global files; a pdf report containing histograms, traces, and speed plots, a csv with all the speeds and locations of the target body part in every frame, and a csv with stats for each event. Each event folder will contain a csv with all the speeds and locations of the target body part surrounding each event.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token builtin class-name">.</span>
└── et_output_2024-01-01_00-04-20/
    ├── 0001_FILE-INFO_escape-stats.csv
    ├── 0001_FILE-INFO_speeds.csv
    ├── 0001_FILE-INFO_report.pdf
    └── events/
        ├── event-1/
        │   └── 0001_FILE-INFO_event-1-speeds.csv
        ├── event-2
        ├── event-3
        └── <span class="token punctuation">..</span>.
</code></pre><p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h3 id="analysing-multiple-videos">Analysing Multiple Videos </h3>
<p>The escape_tracer can be run on multiple videos at once. Instead of running the <em>run_escape_tracer.py</em> script, run the <em>multi_escape_tracer.py</em> script with a path to the project folder contaning all the video folders and it will run the program on every video in the project folder.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python multi_escape_tracer.py <span class="token string">"c:/.../project_data/"</span>
</code></pre><p>If you don't want to run the program on every video, you can add a second argument with a path to a .txt file that lists each video number (corresponding to folder names within the project folder) that you do want to analyse.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code>python multi_escape_tracer.py <span class="token string">"c:/.../project_data/"</span> <span class="token string">"c:/.../videos_to_analyse.txt"</span>
</code></pre><p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h2 id="license">License </h2>
<p>Distributed under the MIT License. See <code>LICENSE.txt</code> for more information.</p>
<p align="right">(<a href="#about-the-project">back to top</a>)</p>
<h2 id="contact">Contact </h2>
<p>Thomas Kane - <a href="mailto:thomas.kane.ucl@gmail.com">thomas.kane.ucl@gmail.com</a></p>
<p>Project Link: <a href="https://github.com/thomasmichaelkane/escape_tracer">https://github.com/thomasmichaelkane/escape_tracer</a></p>
<p align="right">(<a href="#about-the-project">back to top</a>)</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>